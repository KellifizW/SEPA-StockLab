# QM 分析页面 — 快速使用指南

## 📊 图表现已完全修复 ✅

### 🚀 快速开始

```bash
# 第1步：启动 Flask 服务器
python -B app.py

# 第2步：打开浏览器 (新标签页)
# http://localhost:5000/qm/analyze?ticker=ASTI

# 或直接从 dashboard 导航到 QM Analyze
```

---

## 📈 图表功能说明

### K 线图表区域包含：

| 元素 | 颜色 | 说明 |
|------|------|------|
| **K 线** | 绿/红 | 日收盘价格 (绿=涨, 红=跌) |
| **成交量** | 绿/红 | 下方直方图 (按涨跌着色) |
| **SMA50** | 蓝色 | 短期均线 (10周) |
| **SMA150** | 琥珀色 | 中期均线 (30周) |
| **SMA200** | 红色 | 长期均线 (40周) |
| **BB 上轨** | 灰色虚 | Bollinger Bands 阻力 |
| **BB 中轨** | 灰色点 | Bollinger Bands 中值 |
| **BB 下轨** | 灰色虚 | Bollinger Bands 支撑 |

### 交易计划价格线：

| 价格线 | 颜色 | 含义 |
|--------|------|------|
| **Entry** | 深青虚 | 推荐买入价格 |
| **Day 1 Stop** | 红虚 | 第1天止损位 |
| **Day 3+ Trail** | 琥珀虚 | 追踪止损点 |
| **Profit Target** | 绿虚 | 利润目标价 |

---

## 🎯 使用示例

### ASTI ($6.30)
```
☑️ 快速指标显示:
   ├─ 1M 动量: 1.45% (短期温和走势)
   ├─ 3M 动量: 288.89% (强劲上升)
   └─ 6M 动量: 200.00% (持续强势)

☑️ 维度评分 (6 个维度):
   ├─ A 动量: +0.75 (中等)
   ├─ B 平均波幅: +1.0 (优秀 18.6%)
   ├─ C 整固质量: 0.0 (无更高低点)
   ├─ D MA 对齐: +1.0 (完美)
   ├─ E 股票类型: +0.5 (机构)
   └─ F 市场环境: 0.0 (未确认)

☑️ 交易计划:
   ├─ 买入价: $6.30
   ├─ 第1天止损: $5.68 (风险 -7.5%)
   ├─ 追踪止损: $6.11 (风险 -3.0%)
   ├─ 利润目标: $6.93 (+10.0%)
   └─ 风险回报比: 1:2.1

☑️ 图表显示:
   ├─ K 线: 504 天 (约 2 年历史)
   ├─ 成交量: 绿红柱状图
   ├─ 技术线: SMA50/150/200 + Bollinger Bands
   ├─ 价格线: 4 条交易标记线
   └─ 交互: 鼠标悬停查看具体数据
```

---

## 🖱️ 图表交互

### 鼠标操作
| 操作 | 功能 |
|------|------|
| **悬停** | 显示该时间点的 OHLCV 数据 |
| **拖拽** | 移动时间轴，查看历史数据 |
| **滚轮** | 放大/缩小时间区间 |
| **双击** | 重置为全景视图 |

### 工具栏 (图表右上)
- 🔍 缩放工具
- 📐 交易标尺
- 🔄 重置视图

---

## ✅ 完整检查清单

| 项目 | 状态 | 说明 |
|------|------|------|
| 动量数据 (1M/3M/6M) | ✅ | 显示百分比值 |
| 维度评分 (A-F) | ✅ | 显示 6 个维度分数 |
| 星级评分 | ✅ | 4.5★ (精确算法) |
| K 线图表 | ✅ | 绿/红 K 线 |
| 成交量直方图 | ✅ | 下方 18% 区域 |
| SMA 技术线 | ✅ | 50/150/200 日线 |
| Bollinger Bands | ✅ | 上/中/下轨 |
| 交易价格线 | ✅ | Entry/Stop/Target |
| 响应式调整 | ✅ | 窗口缩放自动调整 |
| 错误处理 | ✅ | 友好的出错提示 |

---

## 🔧 故障排除

### 问题 1: 图表没有显示
**解决方法：**
1. 打开浏览器开发工具 (F12)
2. 查看 Console 标签页是否有红色错误信息
3. 检查 Flask 服务器是否在运行 (终端应显示"Running on...")
4. 尝试刷新页面 (Ctrl+R 或 F5)

### 问题 2: 图表数据显示为空
**解决方法：**
1. 确保股票代码正确 (例如 ASTI, NVDA)
2. 确保网络连接正常
3. 等待 1-2 秒让数据加载完成
4. 查看 Flask 终端是否报告 API 错误

### 问题 3: 价格线不显示
**解决方法：**
1. 确保 Trade Plan 有有效的止损和目标价格
2. Trade Plan 的价格值应为正数
3. 如果 Trade Plan 为空，图表仍会显示 K 线但没有价格线

---

## 📝 技术细节

### 图表库
- **Lightweight Charts** (TradingView 免费图表库)
- 轻量级，高性能，支持流畅的交互

### 数据来源
- **Flask API**: `/api/chart/enriched/<ticker>?days=504`
- 返回格式: JSON (candles + volume + indicators)

### 浏览器兼容性
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

---

## 💡 提示

### 最佳使用流程
1. 打开仪表板 (Dashboard)
2. 搜索或扫描股票
3. 对感兴趣的候选股进行深度分析 (QM Analyze)
4. 查看各项指标和图表
5. 根据交易计划的价格线执行交易

### 图表分析要点
- **SMA 黄金交叉**: SMA50 穿过 SMA200 = 强势信号
- **Bollinger Bands**: 价格接近上轨 = 偏强, 接近下轨 = 偏弱
- **成交量**: 成交量峰值 = 强势确认

---

## 🎓 关于维度评分

QM 分析使用 6 个独立维度对股票进行评分：

| 维度 | 范围 | 解释 |
|------|------|------|
| **A: 动量** | 0.0~1.0 | 短期上升力度 |
| **B: ADR** | 0.0~1.0 | 平均日波幅 (18% 为优秀) |
| **C: 整固** | 0.0~1.0 | 底部构筑质量 |
| **D: MA对齐** | 0.0~1.0 | 均线顺序完美度 |
| **E: 类型** | 0.0~1.0 | 机构持仓强度 |
| **F: 市场** | 0.0~1.0 | 大盘环境有利度 |

**总评分** = (A×0.2 + B×0.2 + C×0.15 + D×0.15 + E×0.15 + F×0.15) × 5

---

## 📞 需要帮助？

- 检查 [QM_CHART_FIX_COMPLETE.md](QM_CHART_FIX_COMPLETE.md) 了解修复详情
- 运行 `python tests/verify_qm_chart_fix.py` 验证部署
- 查看 [GUIDE.md](docs/GUIDE.md) 了解完整用户手册

---

**用户友好的分析工具已就绪！** 🎉

现在可以放心地使用 QM 分析页面的完整图表功能了。

