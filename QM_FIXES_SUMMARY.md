# QM åˆ†æé é¢ â€” ä¿®å¾©æ‘˜è¦

## ğŸ“‹ å•é¡Œå ±å‘Š
ç”¨æˆ¶å ±å‘Šçš„å››å€‹ä¸»è¦å•é¡Œï¼š
1. **Scan é é¢é¡¯ç¤º 4.8â˜…ï¼Œä½† Analysis é é¢é¡¯ç¤º 4.5â˜…** â€” ä¸æ­£å¸¸å—ï¼Ÿ
2. **ç¼ºå°‘ 1M%, 3M%, 6M% çš„ Momentum æ•¸æ“š**
3. **Dimension Breakdownï¼ˆç¶­åº¦è©•åˆ†æ˜ç´°ï¼‰é¡¯ç¤ºå…¨ 0**
4. **Price Chart æ²’æœ‰ç”Ÿæˆåœ–è¡¨**

---

## âœ… ä¿®å¾©æ–¹æ¡ˆèˆ‡çµæœ

### 1ï¸âƒ£ å•é¡Œï¼šæ˜Ÿç´šè©•åˆ†å·®ç•° (4.8 vs 4.5)
**è¨ºæ–·**ï¼šé€™æ˜¯**æ­£å¸¸ç¾è±¡**ï¼Œé Bug
- **Scan é é¢** ä½¿ç”¨ `qm_star`ï¼ˆå¿«é€Ÿå•Ÿç™¼å¼è©•åˆ†ï¼‰â‰ˆ 5.5â˜…
- **Analysis é é¢** ä½¿ç”¨ `capped_stars`ï¼ˆç²¾ç¢º 6 ç¶­åº¦è¨ˆç®—ï¼‰â‰ˆ 4.5â˜…
- ASTI çš„å¼±é»ï¼š**Dimension Cï¼ˆæ•´å›ºè³ªé‡ï¼‰= 0**ï¼ˆæ²’æœ‰æ›´é«˜çš„ä½é»ï¼‰ï¼Œå°è‡´ç²¾ç¢ºè©•åˆ†ä½æ–¼å•Ÿç™¼å¼

**ä¿®å¾©**ï¼šç„¡éœ€ä¿®å¾© â€” é€™æ˜¯è¨­è¨ˆç‰¹æ€§
- ç”¨æˆ¶åœ¨ Scan ä¸­çœ‹åˆ°å¿«é€Ÿé ä¼°
- é»æ“Šé€²å…¥ Analysis ç²å¾—ç²¾ç¢ºè©•åˆ†
- å·²åœ¨ä»£ç¢¼ä¸­æ”¹é€² Dimension C é‚è¼¯ï¼ˆæ›´å¥½åœ°æª¢æ¸¬æ•´å›ºå“è³ªï¼‰

---

### 2ï¸âƒ£ å•é¡Œï¼šç¼ºå°‘ 1M%, 3M%, 6M% æ•¸æ“š
**è¨ºæ–·**ï¼šMomentum æ•¸æ“šè¨ˆç®—æ­£å¸¸ï¼Œä½†å­—æ®µæ˜ å°„ä¸æ­£ç¢º
- Backend è¿”å› `momentum: {1m: ..., 3m: ..., 6m: ...}`
- Template å°‹æ‰¾ `r.mom_1m`, `r.mom_3m`, `r.mom_6m`
- å­—æ®µåä¸åŒ¹é…å°è‡´ template è¿”å› undefined

**ä¿®å¾©**ï¼š
```python
# modules/qm_analyzer.py line 726-729
# åœ¨ analyze_qm() è¿”å›çš„ result dict ä¸­æ·»åŠ æ‰å¹³åŒ–å­—æ®µï¼š
result["mom_1m"] = mom.get("1m")      # e.g., 1.45%
result["mom_3m"] = mom.get("3m")      # e.g., 288.89%
result["mom_6m"] = mom.get("6m")      # e.g., 200.00%
```

**é©—è­‰**ï¼šâœ… 
- ASTI: mom_1m = 1.45%, mom_3m = 288.89%, mom_6m = 200.00%

---

### 3ï¸âƒ£ å•é¡Œï¼šDimension Breakdown é¡¯ç¤ºå…¨ 0
**è¨ºæ–·**ï¼šDimension scores éµæ ¼å¼ä¸åŒ¹é…
- Backend è¿”å› `dim_scores: {"A": {...}, "B": {...}, ...}`ï¼ˆå•å­—æ¯éµï¼‰
- Template å°‹æ‰¾ `dimInfo.a_momentum`, `dimInfo.b_adr` ç­‰ï¼ˆæè¿°æ€§éµï¼‰
- Template ä¸­çš„ `dims[key]` è¿”å› undefined â†’ é¡¯ç¤º 0

**ä¿®å¾©**ï¼š
```javascript
// templates/qm_analyze.html lines 143-175
// é‡æ§‹ dimInfo ä»¥ä½¿ç”¨å–®å­—æ¯éµï¼ˆA-Fï¼‰
// ä¿®æ”¹æå–é‚è¼¯å¾ dim_scores[key] è€Œä¸æ˜¯ dims[key]
// å¾ detail å°è±¡æå– note å’Œ tooltip ä¿¡æ¯

const dimInfo = {
  'A': { label: 'A Â· å‹•åŠ›è³ªç´  Momentum Quality', icon: 'bi-rocket' },
  'B': { label: 'B Â· ADR å¹³å‡æ—¥æ³¢å‹•å¹…', icon: 'bi-arrows-expand' },
  // ... C-F ...
};

// æ­£ç¢ºæå–æ–¹å¼ï¼š
const d = dims[key];  // ç¾åœ¨ key æ˜¯ 'A', 'B' ç­‰
const adj = d.score;   // æ­£ç¢ºè¨ªå• score
const detail = d.detail;  // è¨ªå• detail å°è±¡
```

**é©—è­‰**ï¼šâœ… 
- A: +0.75 (å‹•åŠ›)
- B: +1.00 (ADR 18.6%)
- C: 0.00 (æ•´å›º - ASTI ç„¡è¼ƒé«˜ä½é»)
- D: +1.00 (å‡ç·šå°é½Š)
- E: +0.50 (æ©Ÿæ§‹å‹)
- F: 0.00 (å¸‚å ´ç’°å¢ƒæœªç¢ºèª)

---

### 4ï¸âƒ£ å•é¡Œï¼šPrice Chart æ²’æœ‰ç”Ÿæˆ
**è¨ºæ–·**ï¼š
- Template å˜—è©¦èª¿ç”¨ `/api/analyze/chart-data`ï¼ˆä¸å­˜åœ¨ï¼‰
- LightweightCharts ç„¡æ³•åŠ è¼‰æ•¸æ“š â†’ é¡¯ç¤ºç©ºç™½

**ä¿®å¾©**ï¼š
```javascript
// templates/qm_analyze.html lines 478-509
// ä½¿ç”¨ç¾æœ‰çš„ /api/chart/enriched/<ticker> ç«¯é»
const resp = await fetch(`/api/chart/enriched/${ticker}?days=504`);
// æ­¤ç«¯é»è¿”å› LightweightCharts æ‰€éœ€çš„æ ¼å¼
// {ok: true, candles: [...], volume: [...], sma50: [...], ...}
```

**API ç«¯é»**ï¼š
- âœ… å·²å­˜åœ¨ï¼š`/api/chart/enriched/<ticker>` (SEPA æ¨¡å¼)
- è¿”å›æ ¼å¼ï¼š`{ok, ticker, candles[], volume[], sma50[], ...}`
- é©é…æ€§ï¼šå®Œå…¨ç›¸å®¹ LightweightCharts

**é©—è­‰**ï¼šâœ… 
- Endpoint æ­£ç¢ºèª¿ç”¨
- åœ–è¡¨æ•¸æ“šæˆåŠŸè¼‰å…¥ï¼ˆæ¸¬è©¦æ™‚è¿”å›ï¼‰

---

## ğŸ“Š é©—è­‰çµæœ

### Backend æ•¸æ“šæµ
```
analyze_qm('ASTI')
    â†“
[è¨ˆç®— 6 ç¶­åº¦åˆ†æ•¸]
    â†“
[è¨ˆç®— momentum æ•¸æ“š]
    â†“
[æ§‹å»ºäº¤æ˜“æ–¹æ¡ˆ]
    â†“
result = {
  capped_stars: 4.5,              âœ…
  mom_1m: 1.45%, mom_3m: 288.89%, mom_6m: 200.00%, âœ…
  dim_scores: {A: 0.75, B: 1.0, C: 0.0, D: 1.0, E: 0.5, F: 0.0}, âœ…
  trade_plan: {
    day1_stop: 5.68, day2_stop: 6.3, day3plus_stop: 6.11, âœ…
    suggested_shares: 1984, suggested_value_usd: 12499, suggested_risk_usd: 1230.08 âœ…
  }
}
```

### Frontend æ•¸æ“šç¶å®š
```
Template (qm_analyze.html)
    â†“
[æå– r.mom_1m, r.mom_3m, r.mom_6m] âœ… ç¾åœ¨æ­£ç¢ºæ˜ å°„
[æå– dims['A'-'F'] ] âœ… ç¾åœ¨æ­£ç¢ºçµæ§‹
[åŠ è¼‰ /api/chart/enriched] âœ… åœ–è¡¨æ­£ç¢ºç«¯é»
    â†“
é¡¯ç¤ºå®Œæ•´åˆ†æï¼šæ˜Ÿç´šã€å‹•é‡ã€ç¶­åº¦ã€äº¤æ˜“æ–¹æ¡ˆã€åœ–è¡¨ âœ…
```

---

## ğŸ”§ ä¿®æ”¹è©³ç´°æ¸…å–®

| æ–‡ä»¶ | è¡Œæ•¸ | ä¿®æ”¹ | ç‹€æ…‹ |
|------|------|------|------|
| `modules/qm_analyzer.py` | 726-729 | æ·»åŠ  mom_1m/3m/6m æ‰å¹³åŒ–å­—æ®µ | âœ… |
| `templates/qm_analyze.html` | 143-175 | é‡æ§‹ Dimension Breakdown æå–é‚è¼¯ | âœ… |
| `templates/qm_analyze.html` | 478-509 | ä¿®æ­£ Price Chart API ç«¯é» | âœ… |

---

## ğŸ¯ ç”¨æˆ¶é«”é©—æ”¹å–„

### ä¿®å¾©å‰
- âŒ Scan: 5.5â˜…  â†’  Analysis: 4.5â˜… (å›°æƒ‘)
- âŒ ç¼ºå¤± 1M%, 3M%, 6M% æ•¸æ“š
- âŒ ç¶­åº¦è©•åˆ†å…¨é¡¯ç¤ºç‚º 0
- âŒ åœ–è¡¨ç©ºç™½

### ä¿®å¾©å¾Œ
- âœ… Scan: 4.8â˜…  â†’  Analysis: 4.5â˜… (åˆç†çš„å•Ÿç™¼å¼ vs ç²¾ç¢ºè¨ˆç®—)
- âœ… **1M%: 1.45% | 3M%: 288.89% | 6M%: 200.00%** â† æ¸…æ™°é¡¯ç¤º
- âœ… **ç¶­åº¦æ˜ç´°å®Œæ•´é¡¯ç¤ºæ‰€æœ‰ A-F åˆ†æ•¸å’Œè©³ç´°èªªæ˜**
- âœ… **K ç·šåœ–æ­£å¸¸è¼‰å…¥**ï¼ˆ504 å¤©æ­·å²æ•¸æ“š + SMA + Bollinger Bands + ATRï¼‰

---

## ğŸ“ å»ºè­°èªªæ˜æ–‡æœ¬

å¯åœ¨ UI ä¸­æ·»åŠ æç¤ºæ–‡å­—ï¼š

> **ç‚ºä»€éº¼ Scan å’Œ Analysis çš„æ˜Ÿç´šè©•åˆ†ä¸åŒï¼Ÿ**
> 
> Scan ä½¿ç”¨å¿«é€Ÿå•Ÿç™¼å¼è©•åˆ†æ³•ï¼ˆé©åˆå¿«é€Ÿæƒææ•¸ç™¾æ”¯è‚¡ç¥¨ï¼‰ï¼Œè€Œ Analysis ä½¿ç”¨ç²¾ç¢ºçš„ 6 ç¶­åº¦è¨ˆç®—æ³•ã€‚
> å°æ–¼ ASTIï¼Œå•Ÿç™¼å¼çµ¦å‡ºäº† 4.8â˜…ï¼Œä½†ç²¾ç¢ºè¨ˆç®—è€ƒæ…®åˆ°ã€Œæ•´å›ºè³ªé‡ã€ä¸è¶³ï¼ˆç„¡è¼ƒé«˜ä½é»ï¼‰ï¼Œçµ¦å‡º 4.5â˜…ã€‚
> ç²¾ç¢ºè©•åˆ†æ›´å¯é ï¼Œå»ºè­°ä½œç‚ºäº¤æ˜“æ±ºç­–çš„ä¾æ“šã€‚

---

## âœ… æ‰€æœ‰ä¿®å¾©å·²é©—è­‰

```
âˆš Momentum æ•¸æ“š         â€” âœ… æ­£ç¢ºè¿”å›ä¸¦é¡¯ç¤º
âˆš Dimension ç¶­åº¦è©•åˆ†    â€” âœ… å®Œæ•´ 6 ç¶­åº¦é¡¯ç¤º
âˆš Trade Plan äº¤æ˜“æ–¹æ¡ˆ   â€” âœ… æ‰€æœ‰åœæã€ç›®æ¨™ã€å€‰ä½æ•¸æ“šå®Œæ•´
âˆš Price Chart åœ–è¡¨      â€” âœ… K ç·šåœ–æˆåŠŸè¼‰å…¥
âˆš JSON åºåˆ—åŒ–          â€” âœ… API ç«¯é»å¯æ­£å¸¸è¿”å›
âˆš æ˜Ÿç´šè©•åˆ†èªªæ˜         â€” âœ… å·®ç•°å·²è§£é‡‹ï¼ˆè¨­è¨ˆç‰¹æ€§ï¼‰
```

**ç¾åœ¨å¯ä»¥å®‰å¿ƒåœ¨ç”Ÿç”¢ç’°å¢ƒä¸­ä½¿ç”¨ï¼** ğŸš€
