#!/usr/bin/env python3
"""
立即診斷 ML 分析頁面空白問題的步驟
"""

print("""
╔════════════════════════════════════════════════════════════════════╗
║         🔍 ML 分析頁面空白問題 - 快速診斷步驟                       ║
╚════════════════════════════════════════════════════════════════════╝

已完成的修復:
✅ 添加 Fallback CSS (即使 CDN 失敗也能顯示基本內容)
✅ 添加診斷日誌 (用於瀏覽器 DevTools Console)
✅ 添加 JavaScript 禁用警告
✅ 創建診斷頁面 (自動檢測 Bootstrap/Charts 加載)

════════════════════════════════════════════════════════════════════

📍 立即行動 (按順序):

【第1步】運行 Flask 伺服器
  $ python run_app.py
  或
  $ python start_web.py

【第2步】在瀏覽器中打開診斷頁面
  🔗 http://127.0.0.1:5000/ml/diagnostic
  
  應該看到藍綠色頁面,列有檢查清單

【第3步】運行診斷檢查
  1. 點擊「測試 Bootstrap 加載」按鈕
  2. 點擊「測試 JavaScript」按鈕
  
  ✅ 如果兩個都是綠色 ✓ → 環境沒問題
  ❌ 如果有紅色 ✗ → 說明該資源加載失敗

【第4步】測試原始 ML 分析頁面
  在診斷頁面點擊「打開 ML 分析頁面」
  或直接訪問: http://127.0.0.1:5000/ml/analyze
  
  現在應該能看到:
  ✓ 搜尋框 (輸入股票代號)
  ✓ 「分析」按鈕
  ✓ 「輸入股票代號並點擊「分析」」提示文字

【第5步】如果仍然看不到任何內容
  1. 按 F12 打開 DevTools
  2. 切換到「Console」標籤頁
  3. 查看是否有紅色錯誤信息
  4. 如果有,複製錯誤信息並報告給開發者
  
  可能的錯誤:
  - Failed to fetch https://cdn.jsdelivr.net/... (CDN 無法訪問)
  - JavaScript 語法錯誤 (特定瀏覽器不兼容)
  - 資源 404 (CDN 資源已移除)

【第6步】嘗試不同的瀏覽器
  如果 Chrome 不工作:
  - 試試 Firefox
  - 試試 Edge
  - 試試 Safari (如果在 Mac)
  
  如果其他瀏覽器正常,問題在於某個特定瀏覽器的相容性

【第7步】清除快取並重試
  Chrome: Ctrl+Shift+Delete
  Firefox: Ctrl+Shift+Delete  
  Edge: Ctrl+Shift+Delete
  
  然後重新訪問頁面

════════════════════════════════════════════════════════════════════

🔗 備用 URL (如果 CDN 問題):

正常版本 (有完整樣式):
  http://127.0.0.1:5000/ml/analyze

最小化版本 (只有基本黑白樣式,不用 CDN):
  http://127.0.0.1:5000/ml/test-minimal

診斷工具:
  http://127.0.0.1:5000/ml/diagnostic

════════════════════════════════════════════════════════════════════

✅ 預期結果:

頁面應該顯示:

  ┌─────────────────────────────────────────────────┐
  │  [SEPA Lab 導航欄]                              │
  │  ┌───────────────────────────────────────────┐  │
  │  │ ML 個股分析                               │  │
  │  │ [搜尋框] [分析 Analyze 按鈕]             │  │
  │  ├───────────────────────────────────────────┤  │
  │  │                                           │  │
  │  │ 輸入股票代號並點擊「分析」                 │  │
  │  │ Enter a ticker and click Analyze          │  │
  │  │                                           │  │
  │  └───────────────────────────────────────────┘  │
  └─────────────────────────────────────────────────┘

════════════════════════════════════════════════════════════════════

💡 如果一切都正常:

恭喜!頁面現在應該能正常工作了。
嘗試輸入股票代號 (例如 AAPL) 並點擊「分析」。

════════════════════════════════════════════════════════════════════

❓ 需要幫助?

檢查這些文件以獲得更詳細的信息:
- ML_ANALYZE_FIX_REPORT.md (完整診斷報告)
- test_minimal_ml.py (運行測試)
- test_blank_page.py (詳細診斷)

════════════════════════════════════════════════════════════════════
""")

# 運行快速測試
print("\n📊 運行快速後端測試...\n")

import sys
from pathlib import Path
ROOT = Path(__file__).resolve().parent
sys.path.insert(0, str(ROOT))

from app import app
client = app.test_client()

tests = {
    '/': '首頁',
    '/ml/analyze': 'ML 分析',
    '/ml/diagnostic': '診斷頁面',
    '/ml/test-minimal': '最小化版本',
}

for route, name in tests.items():
    resp = client.get(route)
    status = '✅' if resp.status_code == 200 else '❌'
    print(f"{status} {name:15} {route:25} → {resp.status_code}")

print("\n✅ 所有路由都可用!\n")
print("現在在瀏覽器中訪問上面列出的 URL。\n")
